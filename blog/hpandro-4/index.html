<!DOCTYPE html>
<html lang="en-us"><head>
  <meta charset="utf-8">
  
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-Z6J58MYYPV"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-Z6J58MYYPV');
  </script>
  <title>Cesar Rodriguez | Personal blog</title>

  <!-- mobile responsive meta -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="frida ctf challenge websocket">
  <meta name="author" content="Cesar Rodriguez">
  <meta name="generator" content="Hugo 0.70.0" />

  <!-- plugins -->
  
  <link rel="stylesheet" href="https://cmrodriguez.me/plugins/bootstrap/bootstrap.min.css ">
  
  <link rel="stylesheet" href="https://cmrodriguez.me/plugins/slick/slick.css ">
  
  <link rel="stylesheet" href="https://cmrodriguez.me/plugins/themify-icons/themify-icons.css ">
  
  <link rel="stylesheet" href="https://cmrodriguez.me/plugins/venobox/venobox.css ">
  

  <!-- Main Stylesheet -->
  
  <link rel="stylesheet" href="https://cmrodriguez.me/scss/style.min.css" media="screen">

  <!--Favicon-->
  <link rel="shortcut icon" href="https://cmrodriguez.me/images/favicon.png " type="image/x-icon">
  <link rel="icon" href="https://cmrodriguez.me/images/favicon.png " type="image/x-icon">

</head><body>
<!-- preloader start -->
<div class="preloader">
  
</div>
<!-- preloader end -->
<!-- navigation -->
<header class="navigation">
  <div class="container">
    
    <nav class="navbar navbar-expand-lg navbar-white bg-transparent border-bottom pl-0">
      <a class="navbar-brand mobile-view" href="https://cmrodriguez.me"><img class="img-fluid" style="max-height: 5rem;"
          src="https://cmrodriguez.me/images/logo-hermosa2.png" alt="Cesar Rodriguez | Personal blog"></a>
      <button class="navbar-toggler border-0" type="button" data-toggle="collapse" data-target="#navigation">
        <i class="ti-menu h3"></i>
      </button>

      <div class="collapse navbar-collapse text-center" id="navigation">
        <div class="desktop-view">
          <ul class="navbar-nav mr-auto">
            
            <li class="nav-item">
              <a class="nav-link" href="https://twitter.com/warlockk87"><i class="ti-twitter-alt"></i></a>
            </li>
            
            <li class="nav-item">
              <a class="nav-link" href="https://github.com/CesarMRodriguez"><i class="ti-github"></i></a>
            </li>
            
            <li class="nav-item">
              <a class="nav-link" href="https://www.linkedin.com/in/cesar-mario-rodriguez/"><i class="ti-linkedin"></i></a>
            </li>
            
            <li class="nav-item">
              <a class="nav-link" href="https://www.instagram.com/cesarm_rodriguez/"><i class="ti-instagram"></i></a>
            </li>
            
          </ul>
        </div>

        <a class="navbar-brand mx-auto desktop-view" href="https://cmrodriguez.me"><img class="img-fluid" style="max-height: 5rem;"
            src="https://cmrodriguez.me/images/logo-hermosa2.png" alt="Cesar Rodriguez | Personal blog"></a>

        <ul class="navbar-nav">
          
          
          <li class="nav-item">
            <a class="nav-link" href="https://cmrodriguez.me/about">About</a>
          </li>
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="https://cmrodriguez.me/blog">Post</a>
          </li>
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="https://cmrodriguez.me/contact">Contact</a>
          </li>
          
          
        </ul>

        
        <!-- search -->
        <div class="search pl-lg-4">
          <button id="searchOpen" class="search-btn"><i class="ti-search"></i></button>
          <div class="search-wrapper">
            <form action="https://cmrodriguez.me/search" class="h-100">
              <input class="search-box px-4" id="search-query" name="s" type="search" placeholder="Type & Hit Enter...">
            </form>
            <button id="searchClose" class="search-close"><i class="ti-close text-dark"></i></button>
          </div>
        </div>
        

        
      </div>
    </nav>
  </div>
</header>
<!-- /navigation -->

<section class="section-sm">
  <div class="container">
    <div class="row">
      <div class="col-lg-8 mx-auto">
        
        <a href="/categories/frida"
          class="text-primary">Frida</a>
        
        <a href="/categories/android"
          class="text-primary">Android</a>
        
        <a href="/categories/ctf"
          class="text-primary">C t f</a>
        
        <a href="/categories/challenge"
          class="text-primary">Challenge</a>
        
        <a href="/categories/websocket"
          class="text-primary">Websocket</a>
        
        <h2>Solving CTF with Frida - Part 4</h2>
        <div class="mb-3 post-meta">
          <span>By Cesar Rodriguez</span>
          
          <span class="border-bottom border-primary px-2 mx-1"></span>
          <span>23 July 2021</span>
          
        </div>
        
        <img src="https://cmrodriguez.me/images/featured-post/ctf-challenge.png" class="img-fluid w-100 mb-4" alt="Solving CTF with Frida - Part 4">
        
        <div class="content mb-5">
          <p>In this series of posts I&rsquo;ll be solving some persistence challenges from <a href="http://ctf.hpandro.raviramesh.info/">hpandro ctf challenges</a>. hpAndro created an Android application with multiple vulnerabilities, following the <a href="https://github.com/OWASP/owasp-mstg">MSTG</a>.</p>
<p><strong>NOTE: the challenge is solved with an older version of the application. You can find the copy of the apk here: <a href="https://github.com/CesarMRodriguez/lunesdemobile/blob/main/Sesion%206/hpandro.apk">https://github.com/CesarMRodriguez/lunesdemobile/blob/main/Sesion%206/hpandro.apk</a></strong></p>
<p>We have two different challenges to solve:</p>
<ul>
<li>Intercepting WebSockets.</li>
<li>Intercepting Secure WebSockets.</li>
</ul>
<p>Both exercises have the same behavior, so I&rsquo;ll focus on the first one. The challenge here is to intercept the flag that is being sent over websockets. I start by searching the AndroidManifest.xml to find the Activity that could be called in order to solve the task:</p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;activity</span> <span class="na">android:name=</span><span class="s">&#34;com.hpandro.androidsecurity.ui.activity.task.websocket.WebSocketSecureActivity&#34;</span><span class="nt">/&gt;</span>
</code></pre></div><p>by checking the com.hpandro.androidsecurity.ui.activity.task.websocket.WebSocketSecureActivity class. The first method to see is <strong>onCreate</strong> where I found a code similar to the one used in the HTTP and HTTPS challenges. Check <a href="https://cmrodriguez.me/blog/hpandro-1/">hpandro-1</a> for more details on them. It basically configures a Webview and calls the following URL: <a href="http://hpandro.raviramesh.info/ws_task.php">http://hpandro.raviramesh.info/ws_task.php</a></p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//configure WebView and WebSettings
</span><span class="c1"></span><span class="n">a</span><span class="o">.</span><span class="na">D</span><span class="o">(</span><span class="n">a</span><span class="o">.</span><span class="na">J</span><span class="o">((</span><span class="n">WebView</span><span class="o">)</span> <span class="n">y</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">webviewTask</span><span class="o">),</span> <span class="s">&#34;webviewTask!!.settings&#34;</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="kc">true</span><span class="o">),</span> <span class="n">WebSettings</span><span class="o">.</span><span class="na">LayoutAlgorithm</span><span class="o">.</span><span class="na">SINGLE_COLUMN</span><span class="o">,</span> <span class="n">2</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="s">&#34;hpAndro&#34;</span><span class="o">);</span>
<span class="o">...</span>
<span class="n">WebView</span> <span class="n">webView2</span> <span class="o">=</span> <span class="o">(</span><span class="n">WebView</span><span class="o">)</span> <span class="n">y</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">webviewTask</span><span class="o">);</span>
<span class="n">g</span><span class="o">.</span><span class="na">c</span><span class="o">(</span><span class="n">webView2</span><span class="o">);</span>
<span class="c1">//set WebviewClient
</span><span class="c1"></span><span class="n">webView2</span><span class="o">.</span><span class="na">setWebViewClient</span><span class="o">(</span><span class="k">new</span> <span class="n">b</span><span class="o">(</span><span class="k">this</span><span class="o">));</span>
<span class="o">...</span>
<span class="n">Object</span> <span class="n">systemService</span> <span class="o">=</span> <span class="n">getSystemService</span><span class="o">(</span><span class="s">&#34;connectivity&#34;</span><span class="o">);</span>
<span class="k">if</span> <span class="o">(</span><span class="n">systemService</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
    <span class="o">...</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">z</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">WebView</span> <span class="n">webView4</span> <span class="o">=</span> <span class="o">(</span><span class="n">WebView</span><span class="o">)</span> <span class="n">y</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">webviewTask</span><span class="o">);</span>
        <span class="n">g</span><span class="o">.</span><span class="na">c</span><span class="o">(</span><span class="n">webView4</span><span class="o">);</span>
        <span class="c1">//loads the url of the challenge
</span><span class="c1"></span>        <span class="n">webView4</span><span class="o">.</span><span class="na">loadUrl</span><span class="o">(</span><span class="s">&#34;http://hpandro.raviramesh.info/ws_task.php&#34;</span><span class="o">);</span>
        <span class="o">...</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</code></pre></div><p>Whenever I went to the URL in a browser, I found the following content in javascript:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">eval<span class="o">([][(</span>!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]][([][(</span>!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]]</span>+<span class="o">[])[</span>!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[][(</span>!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]])[</span>+!+<span class="o">[]</span>+<span class="o">[</span>+<span class="o">[]]]</span>+<span class="o">([][[]]</span>+<span class="o">[])[</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+!+<span class="o">[]]</span>+<span class="o">([][[]]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">([][(</span>!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]]</span>+<span class="o">[])[</span>!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[][(</span>!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]])[</span>+!+<span class="o">[]</span>+<span class="o">[</span>+<span class="o">[]]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+!+<span class="o">[]]]([][(</span>!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]][([][(</span>!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]]</span>+<span class="o">[])[</span>!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[][(</span>!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]])[</span>+!+<span class="o">[]</span>+<span class="o">[</span>+<span class="o">[]]]</span>+<span class="o">([][[]]</span>+<span class="o">[])[</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+!+<span class="o">[]]</span>+<span class="o">([][[]]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">([][(</span>!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]]</span>+<span class="o">[])[</span>!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[][(</span>!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]])[</span>+!+<span class="o">[]</span>+<span class="o">[</span>+<span class="o">[]]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+!+<span class="o">[]]]((</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">([][[]]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+!+<span class="o">[]]</span>+<span class="o">([][[]]</span>+<span class="o">[])[</span>+!+<span class="o">[]]</span>+<span class="o">([]</span>+<span class="o">[])[(</span>!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[][(</span>!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]])[</span>+!+<span class="o">[]</span>+<span class="o">[</span>+<span class="o">[]]]</span>+<span class="o">([][[]]</span>+<span class="o">[])[</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">([][(</span>!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]]</span>+<span class="o">[])[</span>!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[][(</span>!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]])[</span>+!+<span class="o">[]</span>+<span class="o">[</span>+<span class="o">[]]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[][(</span>!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]])[</span>+!+<span class="o">[]</span>+<span class="o">[</span>+<span class="o">[]]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+!+<span class="o">[]]]()[</span>+!+<span class="o">[]</span>+<span class="o">[</span>!+<span class="o">[]</span>+!+<span class="o">[]]]</span>+<span class="o">(([][[]]</span>+<span class="o">[])[</span>!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">[</span>+!+<span class="o">[]]</span>+<span class="o">[</span>!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">[</span>!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">[</span>+!+<span class="o">[]]</span>+<span class="o">[</span>!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">[</span>!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">([][[]]</span>+<span class="o">[])[</span>+!+<span class="o">[]]</span>+<span class="o">([][[]]</span>+<span class="o">[])[</span>!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">[</span>!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">[</span>+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">[</span>!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">[</span>!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">[</span>+!+<span class="o">[]]</span>+<span class="o">[</span>!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">[</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">[</span>+!+<span class="o">[]]</span>+<span class="o">[</span>!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">[</span>!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">([][[]]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">[</span>!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">[</span>+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">[</span>+!+<span class="o">[]]</span>+<span class="o">[</span>+<span class="o">[]]</span>+<span class="o">[</span>!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">[</span>+!+<span class="o">[]]</span>+<span class="o">[</span>!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">[</span>!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">[</span>!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">[</span>+<span class="o">[]]</span>+<span class="o">([</span>!<span class="o">[]]</span>+<span class="o">[][[]])[</span>+!+<span class="o">[]</span>+<span class="o">[</span>+<span class="o">[]]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">[</span>!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">[</span>+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">[</span>+!+<span class="o">[]]</span>+<span class="o">[</span>!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">[</span>+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">[</span>+!+<span class="o">[]]</span>+<span class="o">[</span>!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">[</span>+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>+!+<span class="o">[]]</span>+<span class="o">([][[]]</span>+<span class="o">[])[</span>+!+<span class="o">[]]</span>+<span class="o">([][[]]</span>+<span class="o">[])[</span>!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">[</span>+!+<span class="o">[]]</span>+<span class="o">[</span>!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">[</span>!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">[</span>+!+<span class="o">[]]</span>+<span class="o">[</span>!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">[</span>!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">[</span>+!+<span class="o">[]]</span>+<span class="o">[</span>!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">[</span>!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">(</span>+<span class="o">(</span>+!+<span class="o">[]</span>+<span class="o">[</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">[</span>!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">[</span>+<span class="o">[]])</span>+<span class="o">[])[</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">[</span>+!+<span class="o">[]]</span>+<span class="o">[</span>!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">[</span>!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">[</span>+!+<span class="o">[]]</span>+<span class="o">[</span>!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">[</span>!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">[</span>+!+<span class="o">[]]</span>+<span class="o">[</span>!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">[</span>!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">[</span>+!+<span class="o">[]]</span>+<span class="o">[</span>!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">[</span>!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">([][[]]</span>+<span class="o">[])[</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">[</span>+!+<span class="o">[]]</span>+<span class="o">[</span>+<span class="o">[]]</span>+<span class="o">[</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">[</span>+!+<span class="o">[]]</span>+<span class="o">[</span>+!+<span class="o">[]]</span>+<span class="o">[</span>+!+<span class="o">[]]</span>+<span class="o">([][[]]</span>+<span class="o">[])[</span>!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">[</span>+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">[</span>!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">[</span>+!+<span class="o">[]]</span>+<span class="o">[</span>!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">[</span>!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">[</span>!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">[</span>+!+<span class="o">[]]</span>+<span class="o">[</span>!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">[</span>!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">([][[]]</span>+<span class="o">[])[</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">[</span>+!+<span class="o">[]]</span>+<span class="o">[</span>+!+<span class="o">[]]</span>+<span class="o">[</span>!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">[</span>!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">[</span>+!+<span class="o">[]]</span>+<span class="o">[</span>!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">[</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">[</span>+!+<span class="o">[]]</span>+<span class="o">[</span>!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">[</span>!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">[</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">[</span>+!+<span class="o">[]]</span>+<span class="o">[</span>!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">[</span>+!+<span class="o">[]]</span>+<span class="o">([][[]]</span>+<span class="o">[])[</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">[</span>+!+<span class="o">[]]</span>+<span class="o">[</span>+<span class="o">[]]</span>+<span class="o">[</span>!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">[</span>+!+<span class="o">[]]</span>+<span class="o">[</span>!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">[</span>!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">[</span>+!+<span class="o">[]]</span>+<span class="o">[</span>!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">[</span>!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">[</span>+!+<span class="o">[]]</span>+<span class="o">[</span>+<span class="o">[]]</span>+<span class="o">[</span>!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">[</span>+!+<span class="o">[]]</span>+<span class="o">[</span>!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">[</span>+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">[</span>+!+<span class="o">[]]</span>+<span class="o">[</span>!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">[</span>!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">[</span>+!+<span class="o">[]]</span>+<span class="o">[</span>!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">[</span>!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">[</span>!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">[</span>!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">[</span>!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">[</span>+!+<span class="o">[]])[(</span>!<span class="o">[]</span>+<span class="o">[])[</span>!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">(</span>+<span class="o">(</span>!+<span class="o">[]</span>+!+<span class="o">[]</span>+<span class="o">[</span>+!+<span class="o">[]]</span>+<span class="o">[</span>+!+<span class="o">[]]))[(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[][(</span>!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]])[</span>+!+<span class="o">[]</span>+<span class="o">[</span>+<span class="o">[]]]</span>+<span class="o">([]</span>+<span class="o">[])[([][(</span>!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]]</span>+<span class="o">[])[</span>!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[][(</span>!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]])[</span>+!+<span class="o">[]</span>+<span class="o">[</span>+<span class="o">[]]]</span>+<span class="o">([][[]]</span>+<span class="o">[])[</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+!+<span class="o">[]]</span>+<span class="o">([][[]]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">([][(</span>!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]]</span>+<span class="o">[])[</span>!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[][(</span>!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]])[</span>+!+<span class="o">[]</span>+<span class="o">[</span>+<span class="o">[]]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+!+<span class="o">[]]][([][[]]</span>+<span class="o">[])[</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>+!+<span class="o">[]]</span>+<span class="o">((</span>+<span class="o">[])[([][(</span>!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]]</span>+<span class="o">[])[</span>!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[][(</span>!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]])[</span>+!+<span class="o">[]</span>+<span class="o">[</span>+<span class="o">[]]]</span>+<span class="o">([][[]]</span>+<span class="o">[])[</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+!+<span class="o">[]]</span>+<span class="o">([][[]]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">([][(</span>!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]]</span>+<span class="o">[])[</span>!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[][(</span>!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]])[</span>+!+<span class="o">[]</span>+<span class="o">[</span>+<span class="o">[]]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+!+<span class="o">[]]]</span>+<span class="o">[])[</span>+!+<span class="o">[]</span>+<span class="o">[</span>+!+<span class="o">[]]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]]]](</span>!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]</span>+<span class="o">[</span>+!+<span class="o">[]])[</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">([</span>!<span class="o">[]]</span>+<span class="o">[][[]])[</span>+!+<span class="o">[]</span>+<span class="o">[</span>+<span class="o">[]]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]]((</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]])[([][(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">([][[]]</span>+<span class="o">[])[</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+!+<span class="o">[]]</span>+<span class="o">([</span>!<span class="o">[]]</span>+<span class="o">[][[]])[</span>+!+<span class="o">[]</span>+<span class="o">[</span>+<span class="o">[]]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]]]()</span>+<span class="o">[])[</span>!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[][(</span>!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]])[</span>+!+<span class="o">[]</span>+<span class="o">[</span>+<span class="o">[]]]</span>+<span class="o">([</span>!<span class="o">[]]</span>+<span class="o">[][[]])[</span>+!+<span class="o">[]</span>+<span class="o">[</span>+<span class="o">[]]]</span>+<span class="o">([][[]]</span>+<span class="o">[])[</span>+!+<span class="o">[]]](([][(</span>!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]][([][(</span>!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]]</span>+<span class="o">[])[</span>!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[][(</span>!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]])[</span>+!+<span class="o">[]</span>+<span class="o">[</span>+<span class="o">[]]]</span>+<span class="o">([][[]]</span>+<span class="o">[])[</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+!+<span class="o">[]]</span>+<span class="o">([][[]]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">([][(</span>!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]]</span>+<span class="o">[])[</span>!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[][(</span>!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]])[</span>+!+<span class="o">[]</span>+<span class="o">[</span>+<span class="o">[]]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+!+<span class="o">[]]]((</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">([][[]]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+!+<span class="o">[]]</span>+<span class="o">([][[]]</span>+<span class="o">[])[</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[</span>+<span class="o">[]])[([</span>!<span class="o">[]]</span>+<span class="o">[][[]])[</span>+!+<span class="o">[]</span>+<span class="o">[</span>+<span class="o">[]]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">([</span>!<span class="o">[]]</span>+<span class="o">[][[]])[</span>+!+<span class="o">[]</span>+<span class="o">[</span>+<span class="o">[]]]</span>+<span class="o">([][(</span>!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]]</span>+<span class="o">[])[</span>!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]]]()[</span>+!+<span class="o">[]</span>+<span class="o">[</span>+<span class="o">[]]]</span>+!<span class="o">[]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[</span>+<span class="o">[]])[([</span>!<span class="o">[]]</span>+<span class="o">[][[]])[</span>+!+<span class="o">[]</span>+<span class="o">[</span>+<span class="o">[]]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">([</span>!<span class="o">[]]</span>+<span class="o">[][[]])[</span>+!+<span class="o">[]</span>+<span class="o">[</span>+<span class="o">[]]]</span>+<span class="o">([][(</span>!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]]</span>+<span class="o">[])[</span>!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]]]()[</span>+!+<span class="o">[]</span>+<span class="o">[</span>+<span class="o">[]]])()[([][(</span>!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]]</span>+<span class="o">[])[</span>!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[][(</span>!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]])[</span>+!+<span class="o">[]</span>+<span class="o">[</span>+<span class="o">[]]]</span>+<span class="o">([][[]]</span>+<span class="o">[])[</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+!+<span class="o">[]]</span>+<span class="o">([][[]]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">([][(</span>!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]]</span>+<span class="o">[])[</span>!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[][(</span>!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]])[</span>+!+<span class="o">[]</span>+<span class="o">[</span>+<span class="o">[]]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+!+<span class="o">[]]]((</span>!<span class="o">[]</span>+<span class="o">[</span>+<span class="o">[]])[([</span>!<span class="o">[]]</span>+<span class="o">[][[]])[</span>+!+<span class="o">[]</span>+<span class="o">[</span>+<span class="o">[]]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">([</span>!<span class="o">[]]</span>+<span class="o">[][[]])[</span>+!+<span class="o">[]</span>+<span class="o">[</span>+<span class="o">[]]]</span>+<span class="o">([][(</span>!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]]</span>+<span class="o">[])[</span>!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]]]()[</span>+!+<span class="o">[]</span>+<span class="o">[</span>+<span class="o">[]]])</span>+<span class="o">[])[</span>+!+<span class="o">[]])</span>+<span class="o">([]</span>+<span class="o">[])[(</span>!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[][(</span>!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]])[</span>+!+<span class="o">[]</span>+<span class="o">[</span>+<span class="o">[]]]</span>+<span class="o">([][[]]</span>+<span class="o">[])[</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">([][(</span>!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]]</span>+<span class="o">[])[</span>!+<span class="o">[]</span>+!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[][(</span>!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]])[</span>+!+<span class="o">[]</span>+<span class="o">[</span>+<span class="o">[]]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[][(</span>!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>!+<span class="o">[]</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!<span class="o">[]</span>+<span class="o">[])[</span>+!+<span class="o">[]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+<span class="o">[]]])[</span>+!+<span class="o">[]</span>+<span class="o">[</span>+<span class="o">[]]]</span>+<span class="o">(</span>!!<span class="o">[]</span>+<span class="o">[])[</span>+!+<span class="o">[]]]()[</span>+!+<span class="o">[]</span>+<span class="o">[</span>!+<span class="o">[]</span>+!+<span class="o">[]]])())())</span><span class="p">;</span>
</code></pre></div><p>After looking for some information about what could be that. I found that the code is done with a liberary called JSFuck (inspired on the <a href="https://es.wikipedia.org/wiki/Brainfuck">brainfuck</a> language). In order to see what was that code, I had to find a JSFuck decoder: <a href="https://enkhee-osiris.github.io/Decoder-JSFuck/">https://enkhee-osiris.github.io/Decoder-JSFuck/</a></p>
<p>After using that page I could decode the content, which was the following one:</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="nx">doSend</span><span class="p">(</span><span class="s2">&#34;Your Flag is hpandro{ws.tTSrUnAId0s9S4ZnM8Yz1QnFlrwfzGpW}&#34;</span><span class="p">)</span>
</code></pre></div><p>So that is the flag needed. But I wanted to solve the issue with Frida, so understanding the content of what the challenge did I had an idea of what to do. This challenge won&rsquo;t be as easy as the ones related to http and https. In those examples we solved the challenges by overriding the shouldInterceptRequest function of the WebViewClient. But websocket messages aren&rsquo;t intercepted by that function, and they go directly through the browser engine.</p>
<p>I could still change GET messages in order to add some payload, so the strategy to follow is:</p>
<p>a- Intercept WebViewClient.shouldOverrideUrl.
b- add a javascript payload that changes the execution in order to capture the message.
c- Send the message to a JavascriptInterface.
+ create or use a class wih JavascriptInterface
+ configure the webview o include the class with javascriptInterface
d- Hook the method from the JavascriptInterface with Frida.</p>
<p>The following image shows the solution proposed:</p>
<p><img src="/images/featured-post/hpandro-4-websockets.png" alt="Websocket Error"></p>
<h3 id="step-a---intercept-webviewclient">Step a - Intercept WebViewClient</h3>
<p>In order to achieve this goal, we can use the same strategy that we did to solve Http and Https traffic interception. In this case the class to inject is &ldquo;v0.d.a.c.a.d.j.b&rdquo; due to the following line:</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="n">webView2</span><span class="o">.</span><span class="na">setWebViewClient</span><span class="o">(</span><span class="k">new</span> <span class="n">b</span><span class="o">(</span><span class="k">this</span><span class="o">));</span>
</code></pre></div><p>The only thing to have in mind is that the script must add a &ldquo;script&rdquo; tag that adds the payload that we will write. The fsunction that does this is the following one:</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">readNewStream</span><span class="p">(</span><span class="nx">inputStream</span><span class="p">)</span> <span class="p">{</span>

    <span class="kd">var</span> <span class="nx">BufferedReader</span> <span class="o">=</span> <span class="nx">Java</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">&#39;java.io.BufferedReader&#39;</span><span class="p">);</span> 
    <span class="kd">var</span> <span class="nx">InputStreamReader</span> <span class="o">=</span> <span class="nx">Java</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">&#39;java.io.InputStreamReader&#39;</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">inputStreamReader</span> <span class="o">=</span> <span class="nx">InputStreamReader</span><span class="p">.</span><span class="nx">$new</span><span class="p">(</span><span class="nx">inputStream</span><span class="p">);</span>
    
    <span class="kd">var</span> <span class="nx">r</span> <span class="o">=</span> <span class="nx">BufferedReader</span><span class="p">.</span><span class="nx">$new</span><span class="p">(</span><span class="nx">inputStreamReader</span><span class="p">);</span>
    
    <span class="kd">var</span> <span class="nx">StringBuilder</span> <span class="o">=</span> <span class="nx">Java</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">&#39;java.lang.StringBuilder&#39;</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">total</span> <span class="o">=</span> <span class="nx">StringBuilder</span><span class="p">.</span><span class="nx">$new</span><span class="p">();</span>
    <span class="kd">var</span> <span class="nb">String</span> <span class="o">=</span> <span class="nx">Java</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">&#39;java.lang.String&#39;</span><span class="p">);</span>
    <span class="k">while</span> <span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">line</span> <span class="o">=</span> <span class="nx">r</span><span class="p">.</span><span class="nx">readLine</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">line</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">total</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">line</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="nb">String</span><span class="p">.</span><span class="nx">$new</span><span class="p">(</span><span class="s1">&#39;\n&#39;</span><span class="p">));</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="s2">&#34;&lt;script&gt;...&lt;/script&gt;&#34;</span> <span class="o">+</span> <span class="nx">total</span><span class="p">.</span><span class="nx">toString</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div><h3 id="step-b---create-javascript-payload">Step b - create javascript payload</h3>
<p>In order to create the javascript payload I wanted to play around with the page in the <strong>chrome://inspect</strong> tab ofth WebView so I could check if the redirection was going to work or not.</p>
<p>The first problem I faced related to the old version of the application is that the developers of the app changed the endpoints of the application to work just with https, and this version of the app pointed to the http endpoint. Depending on the version of the Android OS, the application would show a button to reload the application with https. This would ruin the payload generated in step a. SO in order to avoid this situation I created the following script that could be loaded in the beginning of the application or whenever you launch the websocket task.</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">WebView</span> <span class="o">=</span> <span class="nx">Java</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s2">&#34;android.webkit.WebView&#34;</span><span class="p">);</span>
<span class="nx">WebView</span><span class="p">.</span><span class="nx">loadUrl</span><span class="p">.</span><span class="nx">overload</span><span class="p">(</span><span class="s2">&#34;java.lang.String&#34;</span><span class="p">).</span><span class="nx">implementation</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">theUrl</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">theUrl</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s2">&#34;ws_task.php&#34;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">loadUrl</span><span class="p">(</span><span class="nb">String</span><span class="p">.</span><span class="nx">$new</span><span class="p">(</span><span class="s2">&#34;https://hpandro.raviramesh.info/ws_task.php&#34;</span><span class="p">)</span> <span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">loadUrl</span><span class="p">(</span><span class="nx">theUrl</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>Whenever I opened the application with the inpect, I found the following error:</p>
<p><img src="/images/featured-post/hpandro-4-websocket-error.png" alt="Websocket Error"></p>
<p>This error occurs because the application is loaded over https, and the websocket message is sent over ws (plaintext). In order to avoid this bug in Android you should configure the WenSettings to set the MixedContentMode available. This is done in Java in the following way (<strong>do not use this in an actual application</strong>):</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="n">webView</span><span class="o">.</span><span class="na">getSettings</span><span class="o">().</span><span class="na">setMixedContentMode</span><span class="o">(</span><span class="n">WebSettings</span><span class="o">.</span><span class="na">MIXED_CONTENT_ALWAYS_ALLOW</span><span class="o">);</span>
</code></pre></div><p>In order to do this with Frida, I needed to find a place where to set this script. I needed a function that received the WebView as a parameter or a function in an object that had the WebView as an attribute. I ended up overwriting the following method <em>v0.a.a.a.a.J</em>, which is being called in the onCreate method in the WebSocketActivity:</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="n">a</span><span class="o">.</span><span class="na">D</span><span class="o">(</span><span class="n">a</span><span class="o">.</span><span class="na">J</span><span class="o">((</span><span class="n">WebView</span><span class="o">)</span> <span class="n">y</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">webviewTask</span><span class="o">),</span> <span class="s">&#34;webviewTask!!.settings&#34;</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="kc">true</span><span class="o">),</span> <span class="n">WebSettings</span><span class="o">.</span><span class="na">LayoutAlgorithm</span><span class="o">.</span><span class="na">SINGLE_COLUMN</span><span class="o">,</span> <span class="n">2</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="s">&#34;hpAndro&#34;</span><span class="o">);</span>
</code></pre></div><p>and has the WebView as a parameter:</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">static</span> <span class="n">WebSettings</span> <span class="nf">J</span><span class="o">(</span><span class="n">WebView</span> <span class="n">webView</span><span class="o">,</span> <span class="n">String</span> <span class="n">str</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">z</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">z2</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">z3</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">z4</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">z5</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">g</span><span class="o">.</span><span class="na">c</span><span class="o">(</span><span class="n">webView</span><span class="o">);</span>
    <span class="n">WebSettings</span> <span class="n">settings</span> <span class="o">=</span> <span class="n">webView</span><span class="o">.</span><span class="na">getSettings</span><span class="o">();</span>
    <span class="n">g</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="n">settings</span><span class="o">,</span> <span class="n">str</span><span class="o">);</span>
    <span class="n">settings</span><span class="o">.</span><span class="na">setJavaScriptEnabled</span><span class="o">(</span><span class="n">z</span><span class="o">);</span>
    <span class="n">settings</span><span class="o">.</span><span class="na">setLoadWithOverviewMode</span><span class="o">(</span><span class="n">z2</span><span class="o">);</span>
    <span class="n">settings</span><span class="o">.</span><span class="na">setUseWideViewPort</span><span class="o">(</span><span class="n">z3</span><span class="o">);</span>
    <span class="n">settings</span><span class="o">.</span><span class="na">setSupportZoom</span><span class="o">(</span><span class="n">z4</span><span class="o">);</span>
    <span class="n">settings</span><span class="o">.</span><span class="na">setBuiltInZoomControls</span><span class="o">(</span><span class="n">z5</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">settings</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div><p>The script created is the following one:</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="nx">Java</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">&#39;v0.a.a.a.a&#39;</span><span class="p">);</span>
<span class="nx">a</span><span class="p">.</span><span class="nx">J</span><span class="p">.</span><span class="nx">implementation</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">webView</span><span class="p">,</span> <span class="nx">str</span><span class="p">,</span> <span class="nx">z</span><span class="p">,</span> <span class="nx">z2</span><span class="p">,</span> <span class="nx">z3</span><span class="p">,</span> <span class="nx">z4</span><span class="p">,</span> <span class="nx">z5</span><span class="p">)</span> <span class="p">{</span>   
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;entra aca&#34;</span><span class="p">);</span>
    <span class="nx">webView</span><span class="p">.</span><span class="nx">getSettings</span><span class="p">().</span><span class="nx">setMixedContentMode</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">J</span><span class="p">(</span><span class="nx">webView</span><span class="p">,</span> <span class="nx">str</span><span class="p">,</span> <span class="nx">z</span><span class="p">,</span> <span class="nx">z2</span><span class="p">,</span> <span class="nx">z3</span><span class="p">,</span> <span class="nx">z4</span><span class="p">,</span> <span class="nx">z5</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div><p>There are multiple ways to generate the payload. The final form requires the definition of the step &ldquo;c&rdquo;. I decided to change the send method from the WebSocket class. this is due to the fact that in order to send messages the content must go over this method.</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="c1">//first we set in the prototype of the WebSocket the original send method.
</span><span class="c1"></span><span class="nx">WebSocket</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">send2</span> <span class="o">=</span> <span class="nx">WebSocket</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">send</span><span class="p">;</span> 

<span class="c1">//then we change the send method to call the JavascriptInterface, and then we call the original send method (after this it is send2)
</span><span class="c1"></span><span class="nx">WebSocket</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">send</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">msg</span><span class="p">)</span> <span class="p">{</span> <span class="nx">JInterface</span><span class="p">.</span><span class="nx">showMessage</span><span class="p">(</span><span class="nx">msg</span><span class="p">);</span> <span class="k">this</span><span class="p">.</span><span class="nx">send2</span><span class="p">(</span><span class="nx">msg</span><span class="p">);</span> <span class="p">}</span> 
</code></pre></div><p>The second step of calling the original send method is created in order to not crash the application, so this method can be used in every application.</p>
<h3 id="step-c---create-javascriptinterface-class">Step c - create JavascriptInterface class</h3>
<p>In order to send the content of the message to Java we need to user or implement a <a href="https://developer.android.com/guide/webapps/webview#UsingJavaScript">JavascriptInterface</a> class.</p>
<p>The first thing I tried to do was creating a class dynamically with Frida (as we did when we tried to solve the http challenge). As an example this is an abstract of the previous script:</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">MyWebViewClient</span> <span class="o">=</span> <span class="nx">Java</span><span class="p">.</span><span class="nx">registerClass</span><span class="p">({</span>
      <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;com.example.MyWebViewClient&#39;</span><span class="p">,</span>
      <span class="nx">superClass</span><span class="o">:</span> <span class="nx">WebViewClient</span><span class="p">,</span>
      <span class="nx">methods</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">$init</span><span class="p">()</span> <span class="p">{</span>
          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Constructor called&#39;</span><span class="p">);</span>
        <span class="p">},</span>
        <span class="nx">shouldInterceptRequest</span><span class="o">:</span> <span class="p">[{</span>
          <span class="nx">returnType</span><span class="o">:</span> <span class="s1">&#39;android.webkit.WebResourceResponse&#39;</span><span class="p">,</span>
          <span class="nx">argumentTypes</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;android.webkit.WebView&#39;</span><span class="p">,</span> <span class="s1">&#39;android.webkit.WebResourceRequest&#39;</span><span class="p">],</span>
          <span class="nx">implementation</span><span class="p">(</span><span class="nx">webView</span><span class="p">,</span> <span class="nx">request</span><span class="p">)</span> <span class="p">{</span>

                <span class="p">...</span>
            <span class="p">}</span>
        <span class="p">}],</span>
      <span class="p">}</span>
    <span class="p">});</span>
</code></pre></div><p>It won&rsquo;t work in this scenario because there is no way (or not an easy available way) to add annotations to a class or method in Frida. I also tried looking for a way to do that with reflection in Java, but it wasn&rsquo;t possible either.</p>
<p>So I had to go for an alternative. I tried to use a class that already has a @JavascriptInterface in the application.</p>
<p>In this application I had the following methods:</p>
<p>-&gt; v0.f.i4</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@JavascriptInterface</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">postMessage</span><span class="o">(</span><span class="n">String</span> <span class="n">str</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">{</span>
        <span class="n">h2</span><span class="o">.</span><span class="na">k</span> <span class="n">kVar</span> <span class="o">=</span> <span class="n">h2</span><span class="o">.</span><span class="na">k</span><span class="o">.</span><span class="na">DEBUG</span><span class="o">;</span>
        <span class="n">h2</span><span class="o">.</span><span class="na">a</span><span class="o">(</span><span class="n">kVar</span><span class="o">,</span> <span class="s">&#34;OSJavaScriptInterface:postMessage: &#34;</span> <span class="o">+</span> <span class="n">str</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
        <span class="n">JSONObject</span> <span class="n">jSONObject</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">(</span><span class="n">str</span><span class="o">);</span>
        <span class="n">String</span> <span class="n">string</span> <span class="o">=</span> <span class="n">jSONObject</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">&#34;type&#34;</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">string</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">&#34;rendering_complete&#34;</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">b</span><span class="o">(</span><span class="n">jSONObject</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">string</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">&#34;action_taken&#34;</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">i4</span><span class="o">.</span><span class="na">this</span><span class="o">.</span><span class="na">b</span><span class="o">.</span><span class="na">i</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">a</span><span class="o">(</span><span class="n">jSONObject</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">JSONException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>          
</code></pre></div><p>-&gt; v0.c.b.b.g.a.fq</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@JavascriptInterface</span>
<span class="kd">public</span> <span class="kd">final</span> <span class="n">String</span> <span class="nf">getClickSignals</span><span class="o">(</span><span class="n">String</span> <span class="n">str</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">String</span> <span class="n">str2</span><span class="o">;</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">TextUtils</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">(</span><span class="n">str</span><span class="o">))</span> <span class="o">{</span>
        <span class="n">str2</span> <span class="o">=</span> <span class="s">&#34;Click string is empty, not proceeding.&#34;</span><span class="o">;</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        <span class="n">gv1</span> <span class="n">d</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">b</span><span class="o">.</span><span class="na">d</span><span class="o">();</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">d</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">str2</span> <span class="o">=</span> <span class="s">&#34;Signal utils is empty, ignoring.&#34;</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="n">rl1</span> <span class="n">rl1</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="na">b</span><span class="o">;</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">rl1</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">str2</span> <span class="o">=</span> <span class="s">&#34;Signals object is empty, ignoring.&#34;</span><span class="o">;</span>
            <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">b</span><span class="o">.</span><span class="na">getContext</span><span class="o">()</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">return</span> <span class="n">rl1</span><span class="o">.</span><span class="na">g</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">b</span><span class="o">.</span><span class="na">getContext</span><span class="o">(),</span> <span class="n">str</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">b</span><span class="o">.</span><span class="na">getView</span><span class="o">(),</span> <span class="k">this</span><span class="o">.</span><span class="na">b</span><span class="o">.</span><span class="na">a</span><span class="o">());</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="n">str2</span> <span class="o">=</span> <span class="s">&#34;Context is null, ignoring.&#34;</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="n">a</span><span class="o">.</span><span class="na">e</span><span class="o">(</span><span class="n">str2</span><span class="o">);</span>
    <span class="k">return</span> <span class="s">&#34;&#34;</span><span class="o">;</span>
<span class="o">}</span>

<span class="nd">@JavascriptInterface</span>
<span class="kd">public</span> <span class="kd">final</span> <span class="kt">void</span> <span class="nf">notify</span><span class="o">(</span><span class="n">String</span> <span class="n">str</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">TextUtils</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">(</span><span class="n">str</span><span class="o">))</span> <span class="o">{</span>
        <span class="n">k</span><span class="o">.</span><span class="na">R2</span><span class="o">(</span><span class="s">&#34;URL is empty, ignoring message&#34;</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        <span class="n">c1</span><span class="o">.</span><span class="na">i</span><span class="o">.</span><span class="na">post</span><span class="o">(</span><span class="k">new</span> <span class="n">hq</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">str</span><span class="o">));</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><p>So here the most convenient class was &ldquo;v0.c.b.b.g.a.fq&rdquo;, because it has a the notify Method which receives an String.</p>
<p>The final script with this concept is the following one {{websocket.js}}, but when I run it I get the following error:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="o">[</span>Twitch::com.hpandro.androidsecurity<span class="o">]</span>-&gt; <span class="s2">&#34;&lt;instance: v0.c.b.b.g.a.fq&gt;&#34;</span>
Process crashed: Bad access due to invalid address

***
*** *** *** *** *** *** *** *** *** *** *** *** *** *** *** ***
Build fingerprint: <span class="s1">&#39;Android/vbox86p/vbox86p:9/PI/138:userdebug/test-keys&#39;</span>
Revision: <span class="s1">&#39;0&#39;</span>
ABI: <span class="s1">&#39;x86&#39;</span>
pid: 17009, tid: 17135, name: JavaBridge  &gt;&gt;&gt; com.hpandro.androidsecurity <span class="o">&lt;&lt;&lt;</span>
signal <span class="m">11</span> <span class="o">(</span>SIGSEGV<span class="o">)</span>, code <span class="m">1</span> <span class="o">(</span>SEGV_MAPERR<span class="o">)</span>, fault addr 0x10
Cause: null pointer dereference
    eax <span class="m">00000000</span>  ebx e5e7a85c  ecx e2b80b00  edx <span class="m">00000001</span>
    edi e9af5d9c  esi e2b80b00
    ebp bcd3c608  esp bcd3c520  eip e5d7f707

backtrace:
    <span class="c1">#00 pc 005b1707  /system/lib/libart.so (offset 0x28a000) (artQuickGenericJniTrampoline+103)</span>
    <span class="c1">#01 pc 005f6b8f  /system/lib/libart.so (offset 0x5ea000) (art_quick_generic_jni_trampoline+63)</span>
    <span class="c1">#02 pc 005f0b82  /system/lib/libart.so (offset 0x28a000) (art_quick_invoke_stub+338)</span>
    <span class="c1">#03 pc 000a30ce  /system/lib/libart.so (offset 0x97000) (art::ArtMethod::Invoke(art::Thread*, unsigned int*, unsigned int, art::JValue*, char const*)+222)</span>
    <span class="c1">#04 pc 004d3349  /system/lib/libart.so (offset 0x28a000) (art::(anonymous namespace)::InvokeWithArgArray(art::ScopedObjectAccessAlreadyRunnable const&amp;, art::ArtMethod*, art::(anonymous namespace)::ArgArray*, art::JValue*, char const*)+89)</span>
    <span class="c1">#05 pc 004d45f7  /system/lib/libart.so (offset 0x28a000) (art::InvokeVirtualOrInterfaceWithJValues(art::ScopedObjectAccessAlreadyRunnable const&amp;, _jobject*, _jmethodID*, jvalue*)+471)</span>
    <span class="c1">#06 pc 00381e1f  /system/lib/libart.so (offset 0x28a000) (art::JNI::CallVoidMethodA(_JNIEnv*, _jobject*, _jmethodID*, jvalue*)+959)</span>
    <span class="c1">#07 pc 02ecb568  /data/app/com.android.chrome-rZxYnE7qcLsVDKktRW3EUw==/base.apk (offset 0xbdc000)</span>
***
<span class="o">[</span>Twitch::com.hpandro.androidsecurity<span class="o">]</span>-&gt;
</code></pre></div><p>I then tested the same scenario in another custom application and it didn&rsquo;t work either. I suppose the bug is related to the fact that the browser engine runs in another process, so there can be an error whenever they try to call a changed method in the android application injected with Frida.</p>
<p>The last option here is to upload a class that would set the JavascriptInterface so the message is sent to Java. This can be done with the following Frida API:</p>
<p>Java.openClassFile(&quot;&hellip;&quot;);</p>
<p>which receives the path of a jar, class or dex file. So I needed to create a valid dex file with the class that has the JavaInterface.</p>
<p>I created a project on Android Studio, and coded the following class:</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.hpandro.example</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">android.webkit.JavascriptInterface</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.webkit.WebView</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">JInterfaceInternal</span> <span class="o">{</span>
    <span class="cm">/** Show a toast from the web page */</span>
    <span class="nd">@JavascriptInterface</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">showMessage</span><span class="o">(</span><span class="n">String</span> <span class="n">toast</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">innerFunction</span><span class="o">(</span><span class="n">toast</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">innerFunction</span><span class="o">(</span><span class="n">String</span> <span class="n">content</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Injected class!! &#34;</span> <span class="o">+</span> <span class="n">content</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">setJavaInterface</span><span class="o">(</span><span class="n">WebView</span> <span class="n">webView</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">webView</span><span class="o">.</span><span class="na">addJavascriptInterface</span><span class="o">(</span><span class="k">new</span> <span class="n">JInterfaceInternal</span><span class="o">(),</span><span class="s">&#34;JInterface&#34;</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><p>Then I built it, generating an apk. I unzipped it to get the classes.dex file. After this I had to convert it to jar with the dex2jar tool, in order to remove potential classes that would crash the process of hpAndro. I decided to do it with the jar and not directly with the dex file, because it is easier to manipulate as it is a zip file with .class files per each class. The next step was to upload it to any folder in the application, and then I run:</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="nx">Java</span><span class="p">.</span><span class="nx">perform</span><span class="p">(</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

    <span class="nx">Java</span><span class="p">.</span><span class="nx">openClassFile</span><span class="p">(</span><span class="s2">&#34;/data/data/com.hpandro.androidsecurity/files/injectablefinal.dex&#34;</span><span class="p">).</span><span class="nx">load</span><span class="p">();</span>
<span class="p">});</span>
</code></pre></div><p>Note: the openClassFile does not work well with early instrumentation.
Note2: in order to solve this in one shot, the dex file should be downloaded with Frida to a folder, and then injected automatically with a setTimeout or by overriding some method. I did not do it this way in order to remove complexity of the final solution and focus on the important parts.</p>
<h2 id="step-d---hook-the-method-from-the-javascriptinterface-with-frida">Step d - Hook the method from the JavascriptInterface with Frida.</h2>
<p>Once the class is injected, we have to run:</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="c1">//this is the method hooked from Frida
</span><span class="c1"></span><span class="nx">Java</span><span class="p">.</span><span class="nx">perform</span><span class="p">(</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
   <span class="kd">var</span> <span class="nx">JInternal</span> <span class="o">=</span> <span class="nx">Java</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s2">&#34;com.hpandro.example.JInterfaceInternal&#34;</span><span class="p">);</span> 
   <span class="nx">JInternal</span><span class="p">.</span><span class="nx">showMessage</span><span class="p">.</span><span class="nx">implementation</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">message</span><span class="p">);</span>
   <span class="p">}</span>
<span class="p">});</span>

<span class="c1">//script that changes the behavior of the WebView
</span><span class="c1"></span><span class="nx">Java</span><span class="p">.</span><span class="nx">perform</span><span class="p">(</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

    <span class="kd">var</span> <span class="nx">newClass</span> <span class="o">=</span> <span class="nx">Java</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s2">&#34;com.hpandro.example.JInterfaceInternal&#34;</span><span class="p">);</span>
    
    <span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="nx">Java</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">&#39;v0.a.a.a.a&#39;</span><span class="p">);</span>
    <span class="nx">a</span><span class="p">.</span><span class="nx">J</span><span class="p">.</span><span class="nx">implementation</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">webView</span><span class="p">,</span> <span class="nx">str</span><span class="p">,</span> <span class="nx">z</span><span class="p">,</span> <span class="nx">z2</span><span class="p">,</span> <span class="nx">z3</span><span class="p">,</span> <span class="nx">z4</span><span class="p">,</span> <span class="nx">z5</span><span class="p">)</span> <span class="p">{</span>   
        <span class="nx">newClass</span><span class="p">.</span><span class="nx">setJavaInterface</span><span class="p">(</span><span class="nx">webView</span><span class="p">);</span>
        <span class="nx">webView</span><span class="p">.</span><span class="nx">getSettings</span><span class="p">().</span><span class="nx">setMixedContentMode</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">J</span><span class="p">(</span><span class="nx">webView</span><span class="p">,</span> <span class="nx">str</span><span class="p">,</span> <span class="nx">z</span><span class="p">,</span> <span class="nx">z2</span><span class="p">,</span> <span class="nx">z3</span><span class="p">,</span> <span class="nx">z4</span><span class="p">,</span> <span class="nx">z5</span><span class="p">);</span>
    <span class="p">}</span>
        
    <span class="kd">var</span> <span class="nx">WebViewClient</span> <span class="o">=</span> <span class="nx">Java</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">&#39;v0.d.a.c.a.d.j.b&#39;</span><span class="p">);</span>
    <span class="nx">WebViewClient</span><span class="p">.</span><span class="nx">shouldInterceptRequest</span><span class="p">.</span><span class="nx">overload</span><span class="p">(</span><span class="s1">&#39;android.webkit.WebView&#39;</span><span class="p">,</span> <span class="s1">&#39;android.webkit.WebResourceRequest&#39;</span><span class="p">).</span><span class="nx">implementation</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">webView</span><span class="p">,</span> <span class="nx">request</span><span class="p">)</span> <span class="p">{</span>

        <span class="kd">var</span> <span class="nx">WebResourceResponse</span> <span class="o">=</span> <span class="nx">Java</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">&#39;android.webkit.WebResourceResponse&#39;</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">isFavicon</span> <span class="o">=</span> <span class="nx">request</span><span class="p">.</span><span class="nx">getUrl</span><span class="p">().</span><span class="nx">toString</span><span class="p">().</span><span class="nx">search</span><span class="p">(</span><span class="s2">&#34;favicon.ico&#34;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="nx">request</span><span class="p">.</span><span class="nx">getUrl</span><span class="p">().</span><span class="nx">toString</span><span class="p">().</span><span class="nx">search</span><span class="p">(</span><span class="s2">&#34;mytheme.min.css&#34;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">;</span>
        
        <span class="kd">var</span> <span class="nx">URL</span> <span class="o">=</span> <span class="nx">Java</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">&#39;java.net.URL&#39;</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">URL</span><span class="p">.</span><span class="nx">$new</span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">getUrl</span><span class="p">().</span><span class="nx">toString</span><span class="p">());</span>
        
        <span class="kd">var</span> <span class="nx">HttpURLConnection</span> <span class="o">=</span> <span class="nx">Java</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">&#39;java.net.HttpURLConnection&#39;</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">urlConnection</span> <span class="o">=</span> <span class="nx">Java</span><span class="p">.</span><span class="nx">cast</span><span class="p">(</span><span class="nx">url</span><span class="p">.</span><span class="nx">openConnection</span><span class="p">(),</span><span class="nx">HttpURLConnection</span><span class="p">);</span>
        
        <span class="kd">var</span> <span class="nb">String</span> <span class="o">=</span> <span class="nx">Java</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">&#39;java.lang.String&#39;</span><span class="p">);</span>
        <span class="nx">urlConnection</span><span class="p">.</span><span class="nx">setRequestProperty</span><span class="p">(</span><span class="nb">String</span><span class="p">.</span><span class="nx">$new</span><span class="p">(</span><span class="s2">&#34;User-Agent&#34;</span><span class="p">),</span> <span class="nb">String</span><span class="p">.</span><span class="nx">$new</span><span class="p">(</span><span class="s2">&#34;hpAndro&#34;</span><span class="p">));</span>
        
        <span class="kd">var</span> <span class="nx">BufferedInputStream</span> <span class="o">=</span> <span class="nx">Java</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">&#39;java.io.BufferedInputStream&#39;</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">inputStr</span> <span class="o">=</span> <span class="nx">BufferedInputStream</span><span class="p">.</span><span class="nx">$new</span><span class="p">(</span><span class="nx">urlConnection</span><span class="p">.</span><span class="nx">getInputStream</span><span class="p">());</span>
        <span class="kd">var</span> <span class="nx">webResourceRes</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">isFavicon</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">strToPrint</span> <span class="o">=</span> <span class="nx">readNewStream</span><span class="p">(</span><span class="nx">inputStr</span><span class="p">);</span>
            <span class="c1">//convert to inputStr
</span><span class="c1"></span>            <span class="kd">var</span> <span class="nx">resultado</span> <span class="o">=</span> <span class="nb">String</span><span class="p">.</span><span class="nx">$new</span><span class="p">(</span><span class="nx">strToPrint</span><span class="p">);</span>
            <span class="kd">var</span> <span class="nx">ByteArrayInputStream</span> <span class="o">=</span> <span class="nx">Java</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s2">&#34;java.io.ByteArrayInputStream&#34;</span><span class="p">);</span>
            <span class="kd">var</span> <span class="nx">byteArrayInputStream</span> <span class="o">=</span> <span class="nx">ByteArrayInputStream</span><span class="p">.</span><span class="nx">$new</span><span class="p">(</span><span class="nx">resultado</span><span class="p">.</span><span class="nx">getBytes</span><span class="p">());</span>
            <span class="kd">var</span> <span class="nx">InputStream</span> <span class="o">=</span> <span class="nx">Java</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s2">&#34;java.io.InputStream&#34;</span><span class="p">);</span>
            <span class="kd">var</span> <span class="nx">newInputStream</span> <span class="o">=</span> <span class="nx">Java</span><span class="p">.</span><span class="nx">cast</span><span class="p">(</span><span class="nx">byteArrayInputStream</span><span class="p">,</span><span class="nx">InputStream</span><span class="p">);</span>            
            <span class="nx">webResourceRes</span> <span class="o">=</span> <span class="nx">WebResourceResponse</span><span class="p">.</span><span class="nx">$new</span><span class="p">(</span><span class="s2">&#34;text/html&#34;</span><span class="p">,</span><span class="s2">&#34;utf-8&#34;</span><span class="p">,</span> <span class="nx">newInputStream</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">webResourceRes</span> <span class="o">=</span> <span class="nx">WebResourceResponse</span><span class="p">.</span><span class="nx">$new</span><span class="p">(</span><span class="s2">&#34;image/vnd.microsoft.icon&#34;</span><span class="p">,</span><span class="s2">&#34;gzip&#34;</span><span class="p">,</span> <span class="nx">inputStr</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">webResourceRes</span><span class="p">;</span>
    <span class="p">}</span>
    
<span class="p">});</span>
</code></pre></div><p>This ended up showing the message in the console, but sometimes it crashed (I still do not know the reason if this behavior), so it wasn&rsquo;t reliable. I wanted to find a more stable way to do it.</p>
<p>One of the ways that I found to do this was sending the content in an out of band way. There were lots of alternatives, but I decided to use sockets. So in this case in order to make this work, I needed two components. The first one was a Java class that sends the flag over a socket. This was done in the following way:</p>
<p>I added a method in the JInterfaceInternal class:</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">JInterfaceInternal</span> <span class="o">{</span>

    <span class="nd">@JavascriptInterface</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">sendMessage</span><span class="o">(</span><span class="n">String</span> <span class="n">toast</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">MessageSender</span> <span class="n">messageSender</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MessageSender</span><span class="o">(</span><span class="n">toast</span><span class="o">);</span>
    <span class="o">}</span>
</code></pre></div><p>and then created the MessageSender class that opens a socket and sends a message over there:</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MessageSender</span> <span class="o">{</span>


    <span class="kd">protected</span> <span class="kd">static</span> <span class="n">String</span> <span class="n">SERVER_IP</span> <span class="o">=</span> <span class="s">&#34;127.0.0.1&#34;</span><span class="o">;</span>
    <span class="kd">protected</span> <span class="kd">static</span> <span class="kt">int</span> <span class="n">SERVER_PORT</span> <span class="o">=</span> <span class="n">23389</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">messageToSend</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">PrintWriter</span> <span class="n">output</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">BufferedReader</span> <span class="n">input</span><span class="o">;</span>
    <span class="kd">public</span> <span class="nf">MessageSender</span><span class="o">(</span><span class="n">String</span> <span class="n">messageToSend</span><span class="o">)</span> <span class="o">{</span>

        <span class="k">this</span><span class="o">.</span><span class="na">messageToSend</span> <span class="o">=</span> <span class="n">messageToSend</span><span class="o">;</span>
        <span class="n">Thread</span> <span class="n">thread1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Thread</span><span class="o">(</span><span class="k">new</span> <span class="n">Thread1</span><span class="o">());</span>
        <span class="n">thread1</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">class</span> <span class="nc">Thread1</span> <span class="kd">implements</span> <span class="n">Runnable</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
            <span class="n">Socket</span> <span class="n">socket</span><span class="o">;</span>
            <span class="k">try</span> <span class="o">{</span>
                <span class="n">socket</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Socket</span><span class="o">(</span><span class="n">MessageSender</span><span class="o">.</span><span class="na">SERVER_IP</span><span class="o">,</span> <span class="n">MessageSender</span><span class="o">.</span><span class="na">SERVER_PORT</span><span class="o">);</span>
                <span class="n">output</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PrintWriter</span><span class="o">(</span><span class="n">socket</span><span class="o">.</span><span class="na">getOutputStream</span><span class="o">());</span>
                <span class="n">input</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="n">InputStreamReader</span><span class="o">(</span><span class="n">socket</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">()));</span>
                <span class="k">new</span> <span class="n">Thread</span><span class="o">(</span><span class="k">new</span> <span class="n">Thread3</span><span class="o">(</span><span class="n">messageToSend</span><span class="o">)).</span><span class="na">start</span><span class="o">();</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">class</span> <span class="nc">Thread3</span> <span class="kd">implements</span> <span class="n">Runnable</span> <span class="o">{</span>
        <span class="kd">private</span> <span class="n">String</span> <span class="n">message</span><span class="o">;</span>
        <span class="n">Thread3</span><span class="o">(</span><span class="n">String</span> <span class="n">message</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">this</span><span class="o">.</span><span class="na">message</span> <span class="o">=</span> <span class="n">message</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
            <span class="n">output</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">message</span><span class="o">);</span>
            <span class="n">output</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><p>I also needed to create the message receiver. I decided to create it on Frida directly, and this is the result:</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="nx">Java</span><span class="p">.</span><span class="nx">perform</span><span class="p">(</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>

    <span class="kd">var</span> <span class="nx">Runnable</span> <span class="o">=</span> <span class="nx">Java</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s2">&#34;java.lang.Runnable&#34;</span><span class="p">);</span> 
    
    <span class="kd">var</span> <span class="nx">Thread1</span> <span class="o">=</span> <span class="nx">Java</span><span class="p">.</span><span class="nx">registerClass</span><span class="p">({</span>
      <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;com.example.Thread1&#39;</span><span class="p">,</span>
      <span class="kr">implements</span><span class="o">:</span> <span class="p">[</span><span class="nx">Runnable</span><span class="p">],</span>
      <span class="nx">methods</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">run</span><span class="p">()</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">ServerSocket</span> <span class="o">=</span> <span class="nx">Java</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s2">&#34;java.net.ServerSocket&#34;</span><span class="p">);</span>
            <span class="kd">var</span> <span class="nx">Socket</span> <span class="o">=</span> <span class="nx">Java</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s2">&#34;java.net.Socket&#34;</span><span class="p">);</span>
            <span class="kd">var</span> <span class="nx">BufferedReader</span> <span class="o">=</span> <span class="nx">Java</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s2">&#34;java.io.BufferedReader&#34;</span><span class="p">);</span>
            <span class="kd">var</span> <span class="nx">InputStreamReader</span> <span class="o">=</span> <span class="nx">Java</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s2">&#34;java.io.InputStreamReader&#34;</span><span class="p">);</span>
            <span class="kd">var</span> <span class="nx">serverSocket</span> <span class="o">=</span> <span class="nx">ServerSocket</span><span class="p">.</span><span class="nx">$new</span><span class="p">(</span><span class="mi">23389</span><span class="p">);</span>
            <span class="k">while</span> <span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">socket</span> <span class="o">=</span> <span class="nx">serverSocket</span><span class="p">.</span><span class="nx">accept</span><span class="p">();</span>
                <span class="nx">input</span> <span class="o">=</span> <span class="nx">BufferedReader</span><span class="p">.</span><span class="nx">$new</span><span class="p">(</span><span class="nx">InputStreamReader</span><span class="p">.</span><span class="nx">$new</span><span class="p">(</span><span class="nx">socket</span><span class="p">.</span><span class="nx">getInputStream</span><span class="p">()));</span>
                <span class="kd">var</span> <span class="nx">message</span> <span class="o">=</span> <span class="nx">input</span><span class="p">.</span><span class="nx">readLine</span><span class="p">();</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">message</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">message</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">});</span>


    <span class="kd">var</span> <span class="nx">Thread</span> <span class="o">=</span> <span class="nx">Java</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s2">&#34;java.lang.Thread&#34;</span><span class="p">);</span>

    <span class="kd">var</span> <span class="nx">MessageReceiver2</span> <span class="o">=</span> <span class="nx">Java</span><span class="p">.</span><span class="nx">registerClass</span><span class="p">({</span>
      <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;com.example.MessageReceiver2&#39;</span><span class="p">,</span>
      <span class="nx">methods</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">$init</span><span class="p">()</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">thread1</span> <span class="o">=</span> <span class="nx">Thread</span><span class="p">.</span><span class="nx">$new</span><span class="p">(</span><span class="nx">Thread1</span><span class="p">.</span><span class="nx">$new</span><span class="p">());</span>
          <span class="nx">thread1</span><span class="p">.</span><span class="nx">start</span><span class="p">();</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">});</span>

    <span class="nx">MessageReceiver2</span><span class="p">.</span><span class="nx">$new</span><span class="p">();</span>
<span class="p">});</span>
</code></pre></div><p>And after running the application this way, I could get the flag in a more reliable way.</p>
<p>In the following link <a href="https://github.com/CesarMRodriguez/lunesdemobile/tree/main/Sesion%206">https://github.com/CesarMRodriguez/lunesdemobile/tree/main/Sesion%206</a> you can find the application we used for this post and the scripts used to solve the challenge.</p>

        </div>

        
        
      </div>
    </div>
  </div>
</section>



<footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-3 col-sm-6 mb-5">
        <h6 class="mb-4">Contact Me</h6>
        <ul class="list-unstyled">
          <li class="mb-3"><i
                class="ti-twitter mr-3 text-primary"></i>@warlockk87</li>
          <li class="mb-3"><i class="ti-location-pin mr-3 text-primary"></i>Buenos Aires, Argentina</li>
          <li class="mb-3"><a class="text-dark" href="mailto:cmrodriguez.mobile@gmail.com"><i
                class="ti-email mr-3 text-primary"></i>cmrodriguez.mobile@gmail.com</a>
          </li>
        </ul>
      </div>
      <div class="col-lg-3 col-sm-6 mb-5">
        <h6 class="mb-4">Social Contacts</h6>
        <ul class="list-unstyled">
          
          <li class="mb-3"><a class="text-dark" href="https://twitter.com/warlockk87">twitter</a></li>
          
          <li class="mb-3"><a class="text-dark" href="https://github.com/CesarMRodriguez">github</a></li>
          
          <li class="mb-3"><a class="text-dark" href="https://www.linkedin.com/in/cesar-mario-rodriguez/">linkedin</a></li>
          
          <li class="mb-3"><a class="text-dark" href="https://www.instagram.com/cesarm_rodriguez/">instagram</a></li>
          
        </ul>
      </div>
      <div class="col-lg-3 col-sm-6 mb-5">
        <h6 class="mb-4">Categories</h6>
        <ul class="list-unstyled">
          <li class="mb-3"><a class="text-dark"
              href="/categories/android">Android</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/automation">Automation</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/bug">Bug</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/challenge">Challenge</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/ctf">Ctf</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/frida">Frida</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/http">Http</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/https">Https</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/misc">Misc</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/pixeldungeon">Pixeldungeon</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/sqlite">Sqlite</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/tcp">Tcp</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/udp">Udp</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/websocket">Websocket</a>
          </li>
        </ul>
      </div>
      <div class="col-lg-3 col-sm-6 mb-5">
        <h6 class="mb-4">Quick Links</h6>
        <ul class="list-unstyled">
          
          <li class="mb-3"><a class="text-dark" href="https://cmrodriguez.me/about">About</a></li>
          
          <li class="mb-3"><a class="text-dark" href="https://cmrodriguez.me/blog">Post</a></li>
          
          <li class="mb-3"><a class="text-dark" href="https://cmrodriguez.me/contact">Contact</a></li>
          
        </ul>
      </div>
      <div class="col-12 border-top py-4 text-center">
        | copyright  2020 <a href="https://cmrodriguez.me">Cesar Rodriguez</a> All Rights Reserved |
      </div>
    </div>
  </div>
</footer>

<script>
  var indexURL = "https://cmrodriguez.me/index.json"
</script>

<!-- JS Plugins -->

<script src="https://cmrodriguez.me/plugins/jQuery/jquery.min.js"></script>

<script src="https://cmrodriguez.me/plugins/bootstrap/bootstrap.min.js"></script>

<script src="https://cmrodriguez.me/plugins/slick/slick.min.js"></script>

<script src="https://cmrodriguez.me/plugins/venobox/venobox.min.js"></script>

<script src="https://cmrodriguez.me/plugins/search/fuse.min.js"></script>

<script src="https://cmrodriguez.me/plugins/search/mark.js"></script>

<script src="https://cmrodriguez.me/plugins/search/search.js"></script>

<!-- Main Script -->

<script src="https://cmrodriguez.me/js/script.min.js"></script>
<!-- google analitycs -->
<script>
  (function (i, s, o, g, r, a, m) {
    i['GoogleAnalyticsObject'] = r;
    i[r] = i[r] || function () {
      (i[r].q = i[r].q || []).push(arguments)
    }, i[r].l = 1 * new Date();
    a = s.createElement(o),
      m = s.getElementsByTagName(o)[0];
    a.async = 1;
    a.src = g;
    m.parentNode.insertBefore(a, m)
  })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');
  ga('create', 'Your ID', 'auto');
  ga('send', 'pageview');
</script></body>
</html>